<?php

class Client_ClientModel extends Zend_Db_Table_Abstract {

    protected $_name = 'clients';
    protected $_primary = 'id';
    
    public function init() {

    }

    public function create($params) {
        

        /*
            get current sql date
        */
        $date = new Zend_Db_Expr('NOW()');

        /*
            insert data
        */
        $data = array('fname'         => $params['fname'],
                      'lname'         => $params['lname'],                
                      'address'       => $params['address'],
                      'state'         => $params['state'],
                      'county'        => $params['county'],
                      'city'          => $params['city'],
                      'zip'           => $params['zip'],
                      'phone'         => $params['phone'],
                      'email'         => $params['email'],
                      'bio'           => $params['bio'],
                      'create_date'   => $date);
        

        $this->insert($data);

        return true;
    }


    public function findAll() {
    
       $select = $this->select();
       
       return $this->fetchRow($select);
    }
    
    
    public function findByName($fname = '', $lname = false) {
    
       $select = $this->select()->where("fname = %?%", $fname);
       
       if( isset( $lname )  && $lname != false) {
           $select->where("lname = %?%", $lname);
       }
             
       return $this->fetchRow($select);
    }

    public function updateClient($id, $data) {
        $where = array('id = ?' => (int)$id);
        return parent::update($data, $where) ? true : false;
    }


    public function countByField($field, $val) {
       $select = $this->select()->where("{$field} = ?", $val);
       $select->from($this->_name,'COUNT(id) AS num');
       return $this->fetchRow($select)->num;
    }

}

