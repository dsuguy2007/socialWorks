<?
$this->headScript()->appendFile('/js/vendor/bootstrap-datepicker.js');
$this->headScript()->appendFile('/js/views/reports/isp/medical.js');
$this->headLink()->appendStylesheet('/css/datepicker.css');
?>
<form action="/isp/goals" method="post" id="isp-gen-medical" >
<?= $this->partial("/isp/partials/progress.phtml", array('percentComplete'=>$this->percentComplete,
                                                         'back'=>'/isp/info',
                                                         'id' => $this->consumer->id,
                                                         'next'=>true,
                                                         'formName'=>$this->formName,
                                                         'steps'=>$this->steps,
                                                         'activeStep'=>$this->activeStep)); ?>
<div class="row">
<div class="span12">
<div class="well">

	   <h4>Select Exam information for <?=$this->consumer->fname?> <?=$this->consumer->lname?></h4>
       <input type="hidden" name="id" value="<?=$this->consumer->id?>" />
	   <div class="max-height-450px overflow-auto">
			<? if(isset( $this->physicians )): ?>
			<?= $this->TableHead( array("Physician Name",
                                "Address",
                                "Phone",
                                "Exam Type",
                                "Date of Last Exam",
                                "Result of Exam",
                                "<a class='js-select-all' data-status='n'>Select <i class=''></i></a>",
                                "Edit",
                                "Delete" ), "table table-bordered js-med-index" ) ?>
			<? ksort($this->physicians) ?>
			<?foreach($this->physicians as $p):?>
			<?foreach($p['exams'] as $e):?>
			<?$strDate = strtotime( $e->date ) ?>
			<?= $this->TableRow(array( $this->Truncate($p["name"], 30),
                                   $this->Truncate($p["address"], 30),
                                   $p["phone"],
                                   $e->type,
                                   date('m/d/Y', $strDate ),
                                   "<div class='show-tooltip' title='".$this->escape($e->result)."' data-toggle='tooltip' >".$this->Truncate($e->result, 30)."</div>",
                                   "<center><input type='checkbox' name='exams[]' value='{$e->id}' /></center>",
                                   "<center><a class='pointer crud-new-update-med' data-id='{$e->id}' data-cid='{$this->consumer->id}'><i class='icon-edit'></i></a></center>",
                                   "<center><a id='med-{$e->id}'
                                   class='pointer crud-del-med' data-id='{$e->id}' data-cid='{$this->consumer->id}' title='delete'><i class='icon-remove'></i></a></center>",
                                   ), "class='exam-row-{$e->id} highlight-child'"); ?>
    <?endforeach;?>
    <?endforeach;?> 
    <?= $this->TableFoot("<tr><td colspan='9'><a class='crud-new-update-med pull-right'
						     data-cid='{$this->consumer->id}'
							 data-id=''>Add Exam <i class='icon-plus'></i></a></tr></td>") ?>
	<?endif;?>
	</div>

	<hr />	

	<h4>Please double check insurance information.</h4>
	
	<?= $this->TableHead( array("Insurance Type",
								"Medical #",
								"Medicare #",
								"Information",
								"Edit",
							   "Delete" ), "table table-bordered js-insurance-index" ) ?>
	   <?if(isset($this->insurance)):?>
	   <?foreach($this->insurance as $k=>$i):?>
       
	    <?= $this->TableRow(array( $i['type'],
                                   $i['medical_number'],
                                   $i['medicare_number'],
								   $i['insurance_info'],
                                   "<center><a class='pointer crud-new-update-insurance' data-id='{$i['id']}'><i class='icon-edit'></i></a></center>",
								   "<center><a class='crud-del-insurance icon icon-remove' data-id='{$i['id']}'></a></center>"
								   ), "class='insurance-row-{$i['id']} highlight-child'"); ?>
	   
	   <?endforeach;?>
       <?endif;?>
	   
	   <?= $this->TableFoot("<tr><td colspan='6'><a class='crud-new-update-insurance pull-right'
							    data-id=''
								data-cid='{$this->consumer->id}'>Add Insurance
								<i class='icon icon-plus'></i></a></td></tr>" ) ?>

								

	<hr />	

								
</div>
</div> 
</div>
</form>

<script type="text/plain" id="js-crud-edit-med">
	
	<%if(action == 'new') {%>
	 <tr class='exam-row-<%= values.id %> highlight-child'>
	<% } %>	
	<td><%= physician.name.substring(0, 30)%></td>
	<td><%= physician.address.substring(0, 30)%></td>
	<td><%= physician.phone %></td>
	<td><%= values.type %></td>
	<td><%= values.date %></td>
	<td><div title="<%=values.result%>"><%=values.result.substring(0, 30)  %></div></td>
    <td><center><input type='checkbox' name='exams[]' value='<%= values.id %>' <%= checked %> /></center></td>
	<td><center><a class='pointer crud-new-update-med' data-id='<%= values.id %>' data-cid='<%= consumer_id %>'><i class='icon-edit'></i></a></center></td>
	<td><center><a title="delete" data-cid="<%= consumer_id %>" data-id="<%= values.id %>"
		   class="pointer crud-del-med" id="med-<%= values.id %>"><i class="icon-remove"></i></a></center></td>

	<%if(action == 'new') {%>
	 </tr>
	<% } %>

</script>

<script type="text/plain" id="js-crud-edit-insurance">
	<% if( action == 'new' ){%>
	<tr class="insurance-row-<%= id %> highlight-child">
	<%}%>
	<td><%= values.type %></td>
	<td><%= values.medical_number %></td>
	<td><%= values.medicare_number %></td>
	<td><%= values.insurance_info %></td>
	<td>
		<center>
			<a class='pointer crud-new-update-insurance' data-id='<%= id %>'>
				<i class='icon-edit'></i>
			</a>
		</center>
	</td>
	<td><center><a class="crud-del-insurance icon icon-remove" data-id='<%= id %>'></a></center></td>
	<% if( action == 'new' ){ %>
	</tr>
	<% } %>
</script>